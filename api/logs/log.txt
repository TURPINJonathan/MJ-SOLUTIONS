2025-08-19 17:30:38.518 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-19 17:30:38.620 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-19 17:30:38.622 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-19 17:30:38.622 +02:00 [INF] Hosting environment: Development
2025-08-19 17:30:38.622 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-19 17:30:54.751 +02:00 [INF] Application is shutting down...
2025-08-19 17:30:59.717 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-19 17:30:59.825 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-19 17:30:59.828 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-19 17:30:59.828 +02:00 [INF] Hosting environment: Development
2025-08-19 17:30:59.828 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-19 17:32:44.767 +02:00 [INF] Application is shutting down...
2025-08-19 17:33:11.377 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-19 17:33:11.475 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-19 17:33:11.477 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-19 17:33:11.478 +02:00 [INF] Hosting environment: Development
2025-08-19 17:33:11.478 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-19 17:33:16.784 +02:00 [INF] Application is shutting down...
2025-08-19 17:33:23.634 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-19 17:33:23.729 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-19 17:33:23.732 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-19 17:33:23.732 +02:00 [INF] Hosting environment: Development
2025-08-19 17:33:23.732 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 11:48:37.093 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/logout - null 0
2025-08-20 11:48:37.130 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 11:48:37.192 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:48:37'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 11:48:37.204 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:48:37'.
2025-08-20 11:48:37.208 +02:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-20 11:48:37.212 +02:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-20 11:48:37.215 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/logout - 401 0 null 123.5618ms
2025-08-20 11:48:47.430 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/login - application/json 66
2025-08-20 11:48:47.555 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 11:48:47.574 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(api.Models.LoginModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:48:47.649 +02:00 [INF] Tentative de connexion pour turpin.j@hotmail.fr depuis l'ip ::1
2025-08-20 11:48:48.275 +02:00 [INF] Executed action api.Controllers.AuthController.Login (api) in 697.909ms
2025-08-20 11:48:48.275 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 11:48:48.276 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The LINQ expression 'DbSet<User>()
    .Where(u => AuthController.Decrypt(u.Email) == __login_Email_0)' could not be translated. Additional information: Translation of method 'api.Controllers.AuthController.Decrypt' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information. Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to 'AsEnumerable', 'AsAsyncEnumerable', 'ToList', or 'ToListAsync'. See https://go.microsoft.com/fwlink/?linkid=2101038 for more information.
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutorExpression[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass11_0`1.<ExecuteCore>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteCore[TResult](Expression query, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at api.Controllers.AuthController.Login(LoginModel login)
   at lambda_method10(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_5>d.MoveNext()
--- End of stack trace from previous location ---
   at JwtVersionMiddleware.InvokeAsync(HttpContext context, AppDbContext db)
   at TokenBlacklistMiddleware.InvokeAsync(HttpContext context, AppDbContext db)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-20 11:48:48.286 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/login - 500 null text/plain; charset=utf-8 855.8595ms
2025-08-20 11:49:13.983 +02:00 [INF] Application is shutting down...
 '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 11:48:56.981 +02:00 [ERR] Hosting failed to start
System.IO.IOException: Failed to bind to address http://127.0.0.1:5187: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Address already in use
 ---> System.Net.Sockets.SocketException (98): Address already in use
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
2025-08-20 11:49:20.638 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 11:49:20.732 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 11:49:20.734 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 11:49:20.734 +02:00 [INF] Hosting environment: Development
2025-08-20 11:49:20.734 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 11:50:27.043 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/login - application/json 66
2025-08-20 11:50:27.076 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 11:50:27.207 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 11:50:27.223 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(api.Models.LoginModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:50:27.293 +02:00 [INF] Tentative de connexion pour turpin.j@hotmail.fr depuis l'ip ::1
2025-08-20 11:50:27.903 +02:00 [INF] Executed action api.Controllers.AuthController.Login (api) in 677.4535ms
2025-08-20 11:50:27.906 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 11:50:27.906 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The LINQ expression 'DbSet<User>()
    .Where(u => AuthController.Decrypt(u.Email) == __login_Email_0)' could not be translated. Additional information: Translation of method 'api.Controllers.AuthController.Decrypt' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information. Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to 'AsEnumerable', 'AsAsyncEnumerable', 'ToList', or 'ToListAsync'. See https://go.microsoft.com/fwlink/?linkid=2101038 for more information.
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutorExpression[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass11_0`1.<ExecuteCore>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteCore[TResult](Expression query, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at api.Controllers.AuthController.Login(LoginModel login) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Controllers/AuthController.cs:line 133
   at lambda_method10(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_5>d.MoveNext() in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Program.cs:line 125
--- End of stack trace from previous location ---
   at JwtVersionMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/JwtVersionMiddleware.cs:line 36
   at TokenBlacklistMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/TokenBlacklistMiddleware.cs:line 23
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-20 11:50:27.925 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/login - 500 null text/plain; charset=utf-8 882.6542ms
2025-08-20 11:52:57.870 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 11:52:57.910 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:52:57'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 11:52:57.914 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:52:57'.
2025-08-20 11:52:58.355 +02:00 [INF] Executed DbCommand (39ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 11:52:58.397 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:52:58.402 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:52:58.428 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 25.3784ms
2025-08-20 11:52:58.428 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:52:58.428 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The LINQ expression 'DbSet<User>()
    .Any(u => AuthController.Decrypt(u.Email) == __model_Email_0)' could not be translated. Additional information: Translation of method 'api.Controllers.AuthController.Decrypt' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information. Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to 'AsEnumerable', 'AsAsyncEnumerable', 'ToList', or 'ToListAsync'. See https://go.microsoft.com/fwlink/?linkid=2101038 for more information.
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutorExpression[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass11_0`1.<ExecuteCore>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteCore[TResult](Expression query, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at api.Controllers.AuthController.Register(RegisterModel model) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Controllers/AuthController.cs:line 74
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_5>d.MoveNext() in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Program.cs:line 125
--- End of stack trace from previous location ---
   at JwtVersionMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/JwtVersionMiddleware.cs:line 36
   at TokenBlacklistMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/TokenBlacklistMiddleware.cs:line 23
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-20 11:52:58.435 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 500 null text/plain; charset=utf-8 565.1515ms
2025-08-20 11:53:38.299 +02:00 [INF] Application is shutting down...
2025-08-20 11:53:44.585 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 11:53:44.679 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 11:53:44.681 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 11:53:44.682 +02:00 [INF] Hosting environment: Development
2025-08-20 11:53:44.682 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 11:53:50.461 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 11:53:50.496 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 11:53:50.560 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:53:50'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 11:53:50.578 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:53:50'.
2025-08-20 11:53:51.755 +02:00 [INF] Executed DbCommand (34ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 11:53:51.789 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:53:51.805 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:53:51.889 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 11:53:52.357 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (Size = 250), @p2='?' (DbType = Int32), @p3='?' (Size = 250), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (Size = 250), @p7='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 11:53:52.393 +02:00 [INF] Nouvel utilisateur créé : turpin.j@hotmail.fr
2025-08-20 11:53:52.396 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 11:53:52.422 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 614.8495ms
2025-08-20 11:53:52.423 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:53:52.432 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 1973.2469ms
2025-08-20 11:58:27.751 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 11:58:27.754 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:58:27'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 11:58:27.755 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:58:27'.
2025-08-20 11:58:27.781 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 11:58:27.782 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:58:27.782 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:58:27.784 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 11:58:28.088 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (Size = 250), @p2='?' (DbType = Int32), @p3='?' (Size = 250), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (Size = 250), @p7='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 11:58:28.104 +02:00 [INF] Nouvel utilisateur créé : turpin.j@hotmail.fr
2025-08-20 11:58:28.105 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 11:58:28.105 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 323.0055ms
2025-08-20 11:58:28.105 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:58:28.106 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 354.1679ms
2025-08-20 11:58:39.790 +02:00 [INF] Application is shutting down...
2025-08-20 11:59:38.164 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 11:59:38.265 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 11:59:38.267 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 11:59:38.267 +02:00 [INF] Hosting environment: Development
2025-08-20 11:59:38.267 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 11:59:41.751 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 11:59:41.782 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 11:59:41.835 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:59:41'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 11:59:41.846 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 09:59:41'.
2025-08-20 11:59:42.912 +02:00 [INF] Executed DbCommand (34ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 11:59:42.946 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:59:42.963 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 11:59:43.053 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 11:59:43.534 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 250), @p6='?' (DbType = Int32), @p7='?' (Size = 250), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime), @p10='?' (Size = 250), @p11='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 11:59:43.571 +02:00 [INF] Nouvel utilisateur créé : turpin.j@hotmail.fr
2025-08-20 11:59:43.575 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 11:59:43.604 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 638.7486ms
2025-08-20 11:59:43.606 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 11:59:43.616 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 1865.81ms
2025-08-20 12:01:09.576 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 12:01:09.580 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 10:01:09'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 12:01:09.580 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 10:01:09'.
2025-08-20 12:01:09.597 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:01:09.598 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:01:09.598 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:01:09.600 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 12:01:09.897 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 250), @p6='?' (DbType = Int32), @p7='?' (Size = 250), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime), @p10='?' (Size = 250), @p11='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 12:01:09.912 +02:00 [INF] Nouvel utilisateur créé : turpin.j@hotmail.fr
2025-08-20 12:01:09.912 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 12:01:09.913 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 314.5361ms
2025-08-20 12:01:09.913 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:01:09.913 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 336.5774ms
2025-08-20 12:01:43.917 +02:00 [INF] Application is shutting down...
2025-08-20 12:01:48.431 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:01:48.525 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:01:48.528 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:01:48.528 +02:00 [INF] Hosting environment: Development
2025-08-20 12:01:48.528 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:01:54.633 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 142
2025-08-20 12:01:54.669 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 12:01:54.727 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 10:01:54'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 12:01:54.739 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '19/08/2025 16:01:37', Current time (UTC): '20/08/2025 10:01:54'.
2025-08-20 12:01:55.882 +02:00 [INF] Executed DbCommand (36ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:01:55.918 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:01:55.935 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:01:56.032 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 12:01:56.509 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 250), @p6='?' (DbType = Int32), @p7='?' (Size = 250), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime), @p10='?' (Size = 250), @p11='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 12:01:56.546 +02:00 [INF] Nouvel utilisateur créé : turpin.j@hotmail.fr
2025-08-20 12:01:56.550 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 12:01:56.577 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 640.1319ms
2025-08-20 12:01:56.578 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:01:56.588 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 1956.4995ms
2025-08-20 12:03:13.071 +02:00 [INF] Application is shutting down...
2025-08-20 12:03:17.842 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:03:17.978 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:03:17.981 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:03:17.982 +02:00 [INF] Hosting environment: Development
2025-08-20 12:03:17.982 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:05:04.778 +02:00 [INF] Application is shutting down...
2025-08-20 12:06:30.575 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:06:30.707 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:06:30.710 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:06:30.710 +02:00 [INF] Hosting environment: Development
2025-08-20 12:06:30.711 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:06:32.143 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/login - application/json 66
2025-08-20 12:06:32.179 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 12:06:32.331 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 12:06:32.351 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(api.Models.LoginModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:06:32.432 +02:00 [INF] Tentative de connexion pour turpin.j@hotmail.fr depuis l'ip ::1
2025-08-20 12:06:33.515 +02:00 [INF] Executed DbCommand (35ms) [Parameters=[@__login_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
FROM `Users` AS `u`
WHERE `u`.`Email` = @__login_Email_0
LIMIT 1
2025-08-20 12:06:34.061 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `RefreshTokens` (`ExpiryDate`, `Token`, `UserId`)
VALUES (@p4, @p5, @p6);
SELECT `Id`
FROM `RefreshTokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 12:06:34.091 +02:00 [INF] Connexion réussie pour turpin.j@hotmail.fr depuis ::1
2025-08-20 12:06:34.113 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 12:06:34.139 +02:00 [INF] Executed action api.Controllers.AuthController.Login (api) in 1784.1732ms
2025-08-20 12:06:34.141 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 12:06:34.153 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/login - 200 null application/json; charset=utf-8 2011.4891ms
2025-08-20 12:06:42.184 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 125
2025-08-20 12:06:42.251 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:06:42.275 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:06:42.284 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:06:42.330 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__model_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__model_Email_0)
2025-08-20 12:06:42.714 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 250), @p6='?' (DbType = Int32), @p7='?' (Size = 250), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime), @p10='?' (Size = 250), @p11='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `Users` (`CreatedAt`, `Email`, `JwtVersion`, `PasswordHash`, `Role`, `UpdatedAt`, `firstname`, `lastname`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `Users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 12:06:42.751 +02:00 [INF] Nouvel utilisateur créé : test.j@test.fr
2025-08-20 12:06:42.753 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 12:06:42.764 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 479.4071ms
2025-08-20 12:06:42.764 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:06:42.766 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 200 null application/json; charset=utf-8 581.8802ms
2025-08-20 12:15:41.415 +02:00 [INF] Application is shutting down...
2025-08-20 12:17:13.634 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:17:13.734 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:17:13.736 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:17:13.736 +02:00 [INF] Hosting environment: Development
2025-08-20 12:17:13.736 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:17:19.442 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 125
2025-08-20 12:17:19.475 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 12:17:20.620 +02:00 [INF] Executed DbCommand (33ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:17:20.653 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:17:20.670 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:17:20.877 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u0`.`Id`, `u0`.`CreatedAt`, `u0`.`Email`, `u0`.`JwtVersion`, `u0`.`PasswordHash`, `u0`.`Role`, `u0`.`UpdatedAt`, `u0`.`firstname`, `u0`.`lastname`, `s`.`PermissionsId`, `s`.`UsersId`, `s`.`Id`, `s`.`Name`
FROM (
    SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__email_0
    LIMIT 1
) AS `u0`
LEFT JOIN (
    SELECT `p`.`PermissionsId`, `p`.`UsersId`, `p0`.`Id`, `p0`.`Name`
    FROM `PermissionUser` AS `p`
    INNER JOIN `Permission` AS `p0` ON `p`.`PermissionsId` = `p0`.`Id`
) AS `s` ON `u0`.`Id` = `s`.`UsersId`
ORDER BY `u0`.`Id`, `s`.`PermissionsId`, `s`.`UsersId`
2025-08-20 12:17:20.936 +02:00 [INF] Executing ForbidResult with authentication schemes (["Permission insuffisante."]).
2025-08-20 12:17:20.941 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 268.0917ms
2025-08-20 12:17:20.942 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:17:20.942 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authentication handler is registered for the scheme 'Permission insuffisante.'. The registered schemes are: Bearer. Did you forget to call AddAuthentication().Add[SomeAuthHandler]("Permission insuffisante.",...)?
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ForbidAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Mvc.ForbidResult.ExecuteResultAsync(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_5>d.MoveNext() in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Program.cs:line 125
--- End of stack trace from previous location ---
   at JwtVersionMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/JwtVersionMiddleware.cs:line 36
   at TokenBlacklistMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/TokenBlacklistMiddleware.cs:line 23
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-20 12:17:20.964 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 500 null text/plain; charset=utf-8 1522.723ms
2025-08-20 12:19:35.431 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 125
2025-08-20 12:19:35.458 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:19:35.459 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:19:35.459 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:19:35.461 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u0`.`Id`, `u0`.`CreatedAt`, `u0`.`Email`, `u0`.`JwtVersion`, `u0`.`PasswordHash`, `u0`.`Role`, `u0`.`UpdatedAt`, `u0`.`firstname`, `u0`.`lastname`, `s`.`PermissionsId`, `s`.`UsersId`, `s`.`Id`, `s`.`Name`
FROM (
    SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__email_0
    LIMIT 1
) AS `u0`
LEFT JOIN (
    SELECT `p`.`PermissionsId`, `p`.`UsersId`, `p0`.`Id`, `p0`.`Name`
    FROM `PermissionUser` AS `p`
    INNER JOIN `Permission` AS `p0` ON `p`.`PermissionsId` = `p0`.`Id`
) AS `s` ON `u0`.`Id` = `s`.`UsersId`
ORDER BY `u0`.`Id`, `s`.`PermissionsId`, `s`.`UsersId`
2025-08-20 12:19:35.462 +02:00 [INF] Executing ForbidResult with authentication schemes (["Permission insuffisante."]).
2025-08-20 12:19:35.463 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 3.6292ms
2025-08-20 12:19:35.463 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:19:35.463 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authentication handler is registered for the scheme 'Permission insuffisante.'. The registered schemes are: Bearer. Did you forget to call AddAuthentication().Add[SomeAuthHandler]("Permission insuffisante.",...)?
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ForbidAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Mvc.ForbidResult.ExecuteResultAsync(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Program.<>c.<<<Main>$>b__0_5>d.MoveNext() in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Program.cs:line 125
--- End of stack trace from previous location ---
   at JwtVersionMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/JwtVersionMiddleware.cs:line 36
   at TokenBlacklistMiddleware.InvokeAsync(HttpContext context, AppDbContext db) in /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api/Middleware/TokenBlacklistMiddleware.cs:line 23
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-20 12:19:35.465 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 500 null text/plain; charset=utf-8 34.4625ms
2025-08-20 12:19:37.445 +02:00 [INF] Application is shutting down...
2025-08-20 12:19:41.327 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:19:41.422 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:19:41.424 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:19:41.424 +02:00 [INF] Hosting environment: Development
2025-08-20 12:19:41.424 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:19:49.385 +02:00 [INF] Application is shutting down...
2025-08-20 12:19:53.573 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:19:53.679 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:19:53.681 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:19:53.682 +02:00 [INF] Hosting environment: Development
2025-08-20 12:19:53.682 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 12:19:54.188 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/register - application/json 125
2025-08-20 12:19:54.224 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 12:19:55.350 +02:00 [INF] Executed DbCommand (36ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 12:19:55.387 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:19:55.407 +02:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(api.Models.RegisterModel) on controller api.Controllers.AuthController (api).
2025-08-20 12:19:55.641 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u0`.`Id`, `u0`.`CreatedAt`, `u0`.`Email`, `u0`.`JwtVersion`, `u0`.`PasswordHash`, `u0`.`Role`, `u0`.`UpdatedAt`, `u0`.`firstname`, `u0`.`lastname`, `s`.`PermissionsId`, `s`.`UsersId`, `s`.`Id`, `s`.`Name`
FROM (
    SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
    FROM `Users` AS `u`
    WHERE `u`.`Email` = @__email_0
    LIMIT 1
) AS `u0`
LEFT JOIN (
    SELECT `p`.`PermissionsId`, `p`.`UsersId`, `p0`.`Id`, `p0`.`Name`
    FROM `PermissionUser` AS `p`
    INNER JOIN `Permission` AS `p0` ON `p`.`PermissionsId` = `p0`.`Id`
) AS `s` ON `u0`.`Id` = `s`.`UsersId`
ORDER BY `u0`.`Id`, `s`.`PermissionsId`, `s`.`UsersId`
2025-08-20 12:19:55.700 +02:00 [WRN] Tentative de création d'utilisateur par turpin.j@hotmail.fr depuis l'IP ::1 sans permission.
2025-08-20 12:19:55.705 +02:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 12:19:55.727 +02:00 [INF] Executed action api.Controllers.AuthController.Register (api) in 317.5182ms
2025-08-20 12:19:55.728 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Register (api)'
2025-08-20 12:19:55.737 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/register - 403 null application/json; charset=utf-8 1551.1373ms
2025-08-20 12:37:14.220 +02:00 [INF] Application is shutting down...
2025-08-20 12:43:28.422 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-20 12:43:28.444 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT GET_LOCK('__mj_solutions_EFMigrationsLock', 259200)
2025-08-20 12:43:28.512 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS `__EFMigrationsHistory` (
    `MigrationId` varchar(150) CHARACTER SET utf8mb4 NOT NULL,
    `ProductVersion` varchar(32) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK___EFMigrationsHistory` PRIMARY KEY (`MigrationId`)
) CHARACTER SET=utf8mb4;
2025-08-20 12:43:28.524 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mj_solutions' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-20 12:43:28.526 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-20 12:43:28.535 +02:00 [INF] Applying migration '20250820104308_SeedPermissions'.
2025-08-20 12:43:28.578 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_BEFORE_DROP_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID TINYINT(1);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `Extra` = 'auto_increment'
			AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2025-08-20 12:43:28.595 +02:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_AFTER_ADD_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255), IN `COLUMN_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID INT(11);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
			AND `COLUMN_TYPE` LIKE '%int%'
			AND `COLUMN_KEY` = 'PRI';
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL AUTO_INCREMENT;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2025-08-20 12:43:28.609 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PermissionUser` DROP FOREIGN KEY `FK_PermissionUser_Permission_PermissionsId`;
2025-08-20 12:43:28.913 +02:00 [INF] Executed DbCommand (305ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Permission');
ALTER TABLE `Permission` DROP PRIMARY KEY;
2025-08-20 12:43:28.953 +02:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Permission` RENAME `Permissions`;
2025-08-20 12:43:29.172 +02:00 [INF] Executed DbCommand (218ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Permissions` ADD CONSTRAINT `PK_Permissions` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Permissions', 'Id');
2025-08-20 12:43:29.178 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Permissions` (`Id`, `Name`)
VALUES (1, 'CREATE_USER'),
(2, 'READ_USER'),
(3, 'UPDATE_USER'),
(4, 'DELETE_USER'),
(5, 'CREATE_SKILL'),
(6, 'READ_SKILL'),
(7, 'UPDATE_SKILL'),
(8, 'DELETE_SKILL');
2025-08-20 12:43:29.303 +02:00 [INF] Executed DbCommand (125ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `PermissionUser` ADD CONSTRAINT `FK_PermissionUser_Permissions_PermissionsId` FOREIGN KEY (`PermissionsId`) REFERENCES `Permissions` (`Id`) ON DELETE CASCADE;
2025-08-20 12:43:29.310 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250820104308_SeedPermissions', '9.0.8');
2025-08-20 12:43:29.320 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`;
2025-08-20 12:43:29.329 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`;
2025-08-20 12:43:29.330 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT RELEASE_LOCK('__mj_solutions_EFMigrationsLock')
2025-08-20 12:43:51.899 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 12:43:51.992 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 12:43:51.994 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 12:43:51.995 +02:00 [INF] Hosting environment: Development
2025-08-20 12:43:51.995 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 13:11:52.373 +02:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5187/api/auth/update - application/json 137
2025-08-20 13:11:52.406 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 13:11:52.455 +02:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '20/08/2025 11:06:33', Current time (UTC): '20/08/2025 11:11:52'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-20 13:11:52.465 +02:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '20/08/2025 11:06:33', Current time (UTC): '20/08/2025 11:11:52'.
2025-08-20 13:11:52.468 +02:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (SUPER_ADMIN)
2025-08-20 13:11:52.472 +02:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-20 13:11:52.474 +02:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5187/api/auth/update - 401 0 null 101.7639ms
2025-08-20 13:11:57.325 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5187/api/auth/login - application/json 66
2025-08-20 13:11:57.430 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 13:11:57.450 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(api.Models.LoginModel) on controller api.Controllers.AuthController (api).
2025-08-20 13:11:57.525 +02:00 [INF] Tentative de connexion pour turpin.j@hotmail.fr depuis l'ip ::1
2025-08-20 13:11:58.595 +02:00 [INF] Executed DbCommand (32ms) [Parameters=[@__login_Email_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
FROM `Users` AS `u`
WHERE `u`.`Email` = @__login_Email_0
LIMIT 1
2025-08-20 13:11:59.062 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `RefreshTokens` (`ExpiryDate`, `Token`, `UserId`)
VALUES (@p4, @p5, @p6);
SELECT `Id`
FROM `RefreshTokens`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-20 13:11:59.098 +02:00 [INF] Connexion réussie pour turpin.j@hotmail.fr depuis ::1
2025-08-20 13:11:59.109 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 13:11:59.130 +02:00 [INF] Executed action api.Controllers.AuthController.Login (api) in 1677.3288ms
2025-08-20 13:11:59.130 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.Login (api)'
2025-08-20 13:11:59.137 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5187/api/auth/login - 200 null application/json; charset=utf-8 1812.8692ms
2025-08-20 13:12:05.025 +02:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5187/api/auth/update - application/json 137
2025-08-20 13:12:05.062 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 13:12:05.078 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:12:05.083 +02:00 [INF] Route matched with {action = "UpdateUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateUser(api.Models.UpdateUserModel) on controller api.Controllers.AuthController (api).
2025-08-20 13:12:05.120 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-20 13:12:05.144 +02:00 [INF] Executed action api.Controllers.AuthController.UpdateUser (api) in 61.4419ms
2025-08-20 13:12:05.144 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:12:05.144 +02:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5187/api/auth/update - 400 null application/problem+json; charset=utf-8 119.2165ms
2025-08-20 13:14:20.620 +02:00 [INF] Application is shutting down...
2025-08-20 13:14:26.712 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 13:14:26.814 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 13:14:26.817 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 13:14:26.817 +02:00 [INF] Hosting environment: Development
2025-08-20 13:14:26.818 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 13:14:29.563 +02:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5187/api/auth/update - application/json 137
2025-08-20 13:14:29.596 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 13:14:30.733 +02:00 [INF] Executed DbCommand (34ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 13:14:30.767 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-08-20 13:14:30.767 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-08-20 13:14:30.776 +02:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5187/api/auth/update - 405 0 null 1214.2495ms
2025-08-20 13:14:47.982 +02:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5187/api/auth/update - application/json 137
2025-08-20 13:14:48.014 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 13:14:48.014 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:14:48.038 +02:00 [INF] Route matched with {action = "UpdateUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateUser(api.Models.UpdateUserModel) on controller api.Controllers.AuthController (api).
2025-08-20 13:14:48.199 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-20 13:14:48.256 +02:00 [INF] Executed action api.Controllers.AuthController.UpdateUser (api) in 214.0255ms
2025-08-20 13:14:48.256 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:14:48.257 +02:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5187/api/auth/update - 400 null application/problem+json; charset=utf-8 275.2518ms
2025-08-20 13:19:28.608 +02:00 [INF] Application is shutting down...
2025-08-20 13:19:33.622 +02:00 [INF] User profile is available. Using '/home/john/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-08-20 13:19:33.728 +02:00 [INF] Now listening on: http://localhost:5187
2025-08-20 13:19:33.731 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-20 13:19:33.731 +02:00 [INF] Hosting environment: Development
2025-08-20 13:19:33.732 +02:00 [INF] Content root path: /home/john/Bureau/PROJECTS/MJ-SOLUTIONS/api
2025-08-20 13:19:36.709 +02:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5187/api/auth/update - application/json 137
2025-08-20 13:19:36.741 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-20 13:19:37.844 +02:00 [INF] Executed DbCommand (35ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 13:19:37.878 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:19:37.894 +02:00 [INF] Route matched with {action = "UpdateUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateUser(api.Models.UpdateUserModel) on controller api.Controllers.AuthController (api).
2025-08-20 13:19:38.098 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__model_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `u0`.`Id`, `u0`.`CreatedAt`, `u0`.`Email`, `u0`.`JwtVersion`, `u0`.`PasswordHash`, `u0`.`Role`, `u0`.`UpdatedAt`, `u0`.`firstname`, `u0`.`lastname`, `s`.`PermissionsId`, `s`.`UsersId`, `s`.`Id`, `s`.`Name`
FROM (
    SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
    FROM `Users` AS `u`
    WHERE `u`.`Id` = @__model_UserId_0
    LIMIT 1
) AS `u0`
LEFT JOIN (
    SELECT `p`.`PermissionsId`, `p`.`UsersId`, `p0`.`Id`, `p0`.`Name`
    FROM `PermissionUser` AS `p`
    INNER JOIN `Permissions` AS `p0` ON `p`.`PermissionsId` = `p0`.`Id`
) AS `s` ON `u0`.`Id` = `s`.`UsersId`
ORDER BY `u0`.`Id`, `s`.`PermissionsId`, `s`.`UsersId`
2025-08-20 13:19:38.150 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userConnected_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
FROM `Users` AS `u`
WHERE `u`.`Email` = @__userConnected_0
LIMIT 1
2025-08-20 13:19:38.486 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`
FROM `Permissions` AS `p`
WHERE `p`.`Name` IN ('CREATE_USER', 'UPDATE_USER')
2025-08-20 13:19:38.493 +02:00 [INF] Modification réussie : utilisateur 1 modifié par turpin.j@hotmail.fr depuis l'IP ::1
2025-08-20 13:19:38.653 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p11='?' (DbType = Int32), @p8='?' (Size = 250), @p9='?' (Size = 250), @p10='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `PermissionUser` (`PermissionsId`, `UsersId`)
VALUES (@p4, @p5),
(@p6, @p7);
UPDATE `Users` SET `Email` = @p8, `PasswordHash` = @p9, `UpdatedAt` = @p10
WHERE `Id` = @p11;
SELECT ROW_COUNT();
2025-08-20 13:19:38.690 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 13:19:38.719 +02:00 [INF] Executed action api.Controllers.AuthController.UpdateUser (api) in 821.18ms
2025-08-20 13:19:38.721 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:19:38.732 +02:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5187/api/auth/update - 200 null application/json; charset=utf-8 2025.0973ms
2025-08-20 13:21:58.580 +02:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5187/api/auth/update - application/json 194
2025-08-20 13:21:58.607 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `BlacklistedTokens` AS `b`
    WHERE `b`.`Token` = @__token_0)
2025-08-20 13:21:58.608 +02:00 [INF] Executing endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:21:58.608 +02:00 [INF] Route matched with {action = "UpdateUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateUser(api.Models.UpdateUserModel) on controller api.Controllers.AuthController (api).
2025-08-20 13:21:58.610 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__model_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `u0`.`Id`, `u0`.`CreatedAt`, `u0`.`Email`, `u0`.`JwtVersion`, `u0`.`PasswordHash`, `u0`.`Role`, `u0`.`UpdatedAt`, `u0`.`firstname`, `u0`.`lastname`, `s`.`PermissionsId`, `s`.`UsersId`, `s`.`Id`, `s`.`Name`
FROM (
    SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
    FROM `Users` AS `u`
    WHERE `u`.`Id` = @__model_UserId_0
    LIMIT 1
) AS `u0`
LEFT JOIN (
    SELECT `p`.`PermissionsId`, `p`.`UsersId`, `p0`.`Id`, `p0`.`Name`
    FROM `PermissionUser` AS `p`
    INNER JOIN `Permissions` AS `p0` ON `p`.`PermissionsId` = `p0`.`Id`
) AS `s` ON `u0`.`Id` = `s`.`UsersId`
ORDER BY `u0`.`Id`, `s`.`PermissionsId`, `s`.`UsersId`
2025-08-20 13:21:58.612 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userConnected_0='?' (Size = 250)], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`Id`, `u`.`CreatedAt`, `u`.`Email`, `u`.`JwtVersion`, `u`.`PasswordHash`, `u`.`Role`, `u`.`UpdatedAt`, `u`.`firstname`, `u`.`lastname`
FROM `Users` AS `u`
WHERE `u`.`Email` = @__userConnected_0
LIMIT 1
2025-08-20 13:21:58.613 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`
FROM `Permissions` AS `p`
WHERE `p`.`Name` IN ('CREATE_USER', 'READ_USER', 'UPDATE_USER', 'DELETE_USER', 'CREATE_SKILL', 'READ_SKILL', 'UPDATE_SKILL', 'DELETE_SKILL')
2025-08-20 13:21:58.614 +02:00 [INF] Modification réussie : utilisateur 8 modifié par turpin.j@hotmail.fr depuis l'IP ::1
2025-08-20 13:21:58.625 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Int32), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (DbType = Int32), @p15='?' (DbType = Int32), @p16='?' (DbType = Int32), @p17='?' (DbType = Int32), @p18='?' (DbType = Int32), @p19='?' (DbType = Int32), @p21='?' (DbType = Int32), @p20='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AuditLogs` (`Action`, `Date`, `IpAddress`, `UserEmail`)
VALUES (@p0, @p1, @p2, @p3);
SELECT `Id`
FROM `AuditLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `PermissionUser` (`PermissionsId`, `UsersId`)
VALUES (@p4, @p5),
(@p6, @p7),
(@p8, @p9),
(@p10, @p11),
(@p12, @p13),
(@p14, @p15),
(@p16, @p17),
(@p18, @p19);
UPDATE `Users` SET `UpdatedAt` = @p20
WHERE `Id` = @p21;
SELECT ROW_COUNT();
2025-08-20 13:21:58.644 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[api.Enums.UserRole, api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-20 13:21:58.645 +02:00 [INF] Executed action api.Controllers.AuthController.UpdateUser (api) in 36.8365ms
2025-08-20 13:21:58.645 +02:00 [INF] Executed endpoint 'api.Controllers.AuthController.UpdateUser (api)'
2025-08-20 13:21:58.645 +02:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5187/api/auth/update - 200 null application/json; charset=utf-8 65.3391ms
